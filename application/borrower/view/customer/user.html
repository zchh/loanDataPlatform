
    {extend name="base/base" /}
    {block name="main"}
            <div class="row">
                <div class="box">
                    <div class="box-header">
                        <h3 class="box-title">账户信息</h3>
                    </div>
                    <!-- /.box-header -->
                    <div class="box-body no-padding">
                        <table class="table table-condensed">
                            <tr>
                                <td>头像</td>
                                <td><img src="{$data.img}" id="img" width="200px"></td>
                                <td>
                                    <div id="uploader-demo">
                                        <!--用来存放item-->
                                        <div id="fileList" class="uploader-list"></div>
                                        <div id="filePicker">修改</div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>真实姓名</td>
                                <td>{$data.real_name}</td>
                                <td>
                                    <button type="button" class="btn btn-default" data-toggle="modal" data-target="#real_name">
                                    修改
                                   </button>
                                </td>
                            </tr>
                            <tr>
                                <td>修改密码</td>
                                <td>已设置</td>
                                <td>
                                    <button type="button" class="btn btn-default" data-toggle="modal" data-target="#modal-default">
                                        修改
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>联系邮箱：</td>
                                <td>{$data.email}</td>
                                <td>
                                    <button type="button" class="btn btn-default" data-toggle="modal" data-target="#modal-email">
                                        修改
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>联系电话：</td>
                                <td>{$data.tel}</td>
                            </tr>
                            <tr>
                                <td>年龄</td>
                                <td>{$data.age}</td>
                                <td>
                                    <button type="button" class="btn btn-default" data-toggle="modal" data-target="#modal-age">
                                        设置
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>锁定城市</td>
                                <td>{$data.city_id}</td>
                            </tr>
                            <tr>
                                <td>联系微信</td>
                                <td>{$data.weixin}</td>
                                <td>
                                    <button type="button" class="btn btn-default" data-toggle="modal" data-target="#modal-weixin">
                                        设置
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>备用联系人</td>
                                <td>{$data.contact}</td>
                                <td>
                                    <button type="button" class="btn btn-default" data-toggle="modal" data-target="#modal-contack">
                                        设置
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>账户余额</td>
                                <td>{$data.balance}</td>
                                <td>
                                    <button type="button" class="btn btn-default" data-toggle="modal" data-target="#modal-default1">
                                        历史记录
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>流量计划：({$data.flow_plan}位/天）</td>
                                <td>{$data.flow_plan}</td>
                            </tr>

                        </table>
                    </div>
                    <!-- /.box-body -->
                </div>
                <div class="modal fade" id="modal-default">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title">修改密码</h4>
                            </div>
                            <div class="col-xs-9">
                                旧密码：<input type="password" class="form-control" placeholder="请输入旧密码" id="old">
                            </div>
                            <div class="col-xs-9">
                                新密码：<input type="password" class="form-control" placeholder="请输入新密码" id="new">
                            </div>
                            <div class="col-xs-9">
                                确认密码：<input type="password" class="form-control" placeholder="确认密码" id="confirm">
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary">确认修改</button>
                            </div>
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div><!-- 修改密码 -->
                <div class="modal fade" id="real_name"><!-- 修改姓名 -->
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title">修改姓名</h4>
                            </div>
                            <div class="col-xs-9">
                                姓名：<input type="text" class="form-control" placeholder="请输入真实姓名" id="username">
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary1">确认修改</button>
                            </div>
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div><!-- 修改姓名 -->
                <div class="modal fade" id="modal-email"><!-- 修改姓名 -->
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title">修改邮箱</h4>
                            </div>
                            <div class="col-xs-9">
                                邮箱：<input type="text" class="form-control" placeholder="请输入邮箱" id="_email">
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary2">确认修改</button>
                            </div>
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div><!-- 修改邮箱 -->
                <div class="modal fade" id="modal-age"><!-- 修改年龄 -->
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title">修改年龄</h4>
                            </div>
                            <div class="col-xs-9">
                                年龄：<input type="text" class="form-control" placeholder="请输入年龄" id="_age">
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary3">确认修改</button>
                            </div>
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div><!-- 设置年龄 -->
                <div class="modal fade" id="modal-weixin"><!-- 修改微信 -->
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title">修改微信号</h4>
                            </div>
                            <div class="col-xs-9">
                                微信：<input type="text" class="form-control" placeholder="请输入微信号" id="_weixin">
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary4">确认修改</button>
                            </div>
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div><!-- 设置微信 -->
                <div class="modal fade" id="modal-default1"><!-- 查看余额 -->
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title">查看余额</h4>
                                <div class="box-body">
                                    <table id="example1" class="table table-bordered table-striped">
                                        <thead>
                                        <tr>
                                            <th>金额</th>
                                            <th>说明</th>
                                            <th>时间</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                          <?php foreach($snacks as $s):?>
                                             <tr>
                                                 <td><?=$s['balance']?></td>
                                                 <td><?=$s['describe']?></td>
                                                 <td><?=date('Y-m-d h:i:s',$s['add_time'])?></td>
                                             </tr>
                                          <?php endforeach;?>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div><!-- 查看余额 -->
                <div class="modal fade" id="modal-contack"><!-- 修改备用联系人 -->
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title">修改备用联系人</h4>
                            </div>
                            <div class="col-xs-9">
                                备用联系人：<input type="text" class="form-control" placeholder="请输入备用联系人" id="_contack">
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary5">确认修改</button>
                            </div>
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div><!-- 设置备用联系人 -->
                <!--/.col (right) -->
            </div>

<!-- jQuery 3 -->
<script src="__STATIC__/bower_components/jquery/dist/jquery.min.js"></script>
<script type="text/javascript" src="__STATIC__/webuploader/webuploader.js"></script>
<script src="__STATIC__/layer/layer.js"></script>
<!-- AdminLTE for demo purposes -->
<script type="text/javascript">
    //修改头像
    var uploader = WebUploader.create({

        // 选完文件后，是否自动上传。
        auto: true,

        // swf文件路径
        swf: '__STATIC__/webuploader/Uploader.swf',

        // 文件接收服务端。
        server: '{:url("borrower/Customer/img")}',

        // 选择文件的按钮。可选。
        // 内部根据当前运行是创建，可能是input元素，也可能是flash.
        pick: '#filePicker',

        // 只允许选择图片文件。
        accept: {
            title: 'Images',
            extensions: 'gif,jpg,jpeg,bmp,png',
            mimeTypes: 'image/*'
        }
    });
    uploader.on( 'uploadSuccess', function( file,response) {
        //console.log(response.url);
        //$( '#'+file.id ).addClass('');
        //response图片地址
        //console.log(response.url);
        $("#img").attr("src",response.img);
        //$("#goods-logo").val(response.url);
        //console.debug($("#goods-logo").val());
    });
    //修改密码
   $(".btn-primary").on('click',function () {
      var old_password =  $("#old").val();//旧密码
      var new_password = $("#new").val();//新密码
       var confirm_password = $("#confirm").val();//确认密码
       if(old_password.trim() == ''){
         layer.msg("密码不可为空",{icon:0});
         return false;
       }
       if(new_password.trim() == ''){
           layer.msg("新密码不可为空",{icon:0});
           return false;
       }
       if(confirm_password.trim() == ''){
           layer.msg("请再确认一次密码",{icon:0});
           return false;
       }
       if(confirm_password.trim() != new_password.trim()){
           layer.msg("确认密码必须与新密码一致",{icon:0});
           return false;
       }
       $.post("{:url('borrower/Customer/check')}",{'password':old_password},function (rows) {
           if(rows.status == 0){
               layer.msg(rows.msg,{icon:0,time:2000},function () {
                   window.location.reload();
               });
               return false;
           }
           else {
               $.post("{:url('borrower/Customer/change')}",{'new_password':new_password},function (data) {
                   if(data.status == 1){
                       layer.msg(data.msg,{icon:1,time:2000},function () {
                           window.location.reload();
                       });
                   }
                   else {
                       layer.msg(data.msg,{icon:0,time:2000},function () {
                           window.location.reload();
                       });
                       return false;
                   }
               });
           }
       });

   })
    //修改姓名
    $(".btn-primary1").on('click',function () {
        var username = $("#username").val();
        var checkName = /^[\u4e00-\u9fa5]+(·[\u4e00-\u9fa5]+)*$/;
        if(checkName.test(username)){
            $.post("{:url('borrower/Customer/check_username')}",{'real_name':username},function (data) {
                if(data.status == 1){
                    layer.msg(data.msg,{icon:1,time:1000},function () {
                        window.location.reload();
                    });
                }
                else {
                    layer.msg(data.msg,{icon:0,time:1000},function () {
                        window.location.reload();
                    });
                    return false;
                }
            })

        }else{
            layer.msg("请输入正确的中文名",{icon:0});
            return false;
        }

    })
    //修改邮箱
    $(".btn-primary2").on('click',function () {
        var email = $("#_email").val();
        var checkEmail = /^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/;
        if(checkEmail.test(email)){
            $.post("{:url('borrower/Customer/check_email')}",{'email':email},function (data) {
                if(data.status == 1){
                    layer.msg(data.msg,{icon:1,time:1000},function () {
                        window.location.reload();
                    });
                }
                else {
                    layer.msg(data.msg,{icon:0,time:1000},function () {
                        window.location.reload();
                    });
                    return false;
                }
            })

        }else{
            layer.msg("请输入正确的邮箱",{icon:0});
            return false;
        }

    })
    //设置年龄
    $(".btn-primary3").on('click',function () {
        var age = $("#_age").val();
        var checkAge = /^(?:[1-9][0-9]?|1[01][0-9]|120)$/;
        if(checkAge.test(age)){
            $.post("{:url('borrower/Customer/check_age')}",{'age':age},function (data) {
                if(data.status == 1){
                    layer.msg(data.msg,{icon:1,time:1000},function () {
                        window.location.reload();
                    });
                }
                else {
                    layer.msg(data.msg,{icon:0,time:1000},function () {
                        window.location.reload();
                    });
                    return false;
                }
            })

        }else{
            layer.msg("请输入正确的年龄",{icon:0});
            return false;
        }
        
    })
    //设置微信
    $(".btn-primary4").on('click',function () {
        var weixin = $("#_weixin").val();
        var checkWei =/^[a-zA-Z]([-_a-zA-Z0-9]{5,19})+$/;
        if(checkWei.test(weixin)){
            $.post("{:url('borrower/Customer/check_weixin')}",{'weixin':weixin},function (data) {
                if(data.status == 1){
                    layer.msg(data.msg,{icon:1,time:1000},function () {
                        window.location.reload();
                    });
                }
                else {
                    layer.msg(data.msg,{icon:0,time:1000},function () {
                        window.location.reload();
                    });
                    return false;
                }
            })

        }else{
            layer.msg("请输入正确的微信号",{icon:0});
            return false;
        }

    })
    //设置备用联系人
    $(".btn-primary5").on('click',function () {
        var contack = $("#_contack").val();
        if(contack.trim() != ''){
            $.post("{:url('borrower/Customer/check_contack')}",{'contack':contack},function (data) {
                if(data.status == 1){
                    layer.msg(data.msg,{icon:1,time:1000},function () {
                        window.location.reload();
                    });
                }
                else {
                    layer.msg(data.msg,{icon:0,time:1000},function () {
                        window.location.reload();
                    });
                    return false;
                }
            })

        }else{
            layer.msg("备用联系人不可为空",{icon:0});
            return false;
        }

    })
</script>
{/block}

